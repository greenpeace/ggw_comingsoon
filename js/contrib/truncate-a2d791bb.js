!function(module,$,undefined){function setText(element,text){if(element.innerText)element.innerText=text;else if(element.nodeValue)element.nodeValue=text;else{if(!element.textContent)return!1;element.textContent=text}}function truncateNearestSibling($element,$rootNode,$clipNode,options){var $prevSibling,$parent=$element.parent();$element.remove();var clipLength=$clipNode?$clipNode.length:0;if($parent.contents().length>clipLength)return $prevSibling=$parent.contents().eq(-1-clipLength),truncateTextContent($prevSibling,$rootNode,$clipNode,options);var $parentSibling=$parent.prev();return $prevSibling=$parentSibling.contents().eq(-1),$prevSibling.length?(setText($prevSibling[0],$prevSibling.text()+options.ellipsis),$parent.remove(),$clipNode.length&&$parentSibling.append($clipNode),!0):!1}function truncateTextContent($element,$rootNode,$clipNode,options){for(var mid,chunk,element=$element[0],original=$element.text(),maxChunk="",low=0,high=original.length;high>=low;)mid=low+(high-low>>1),chunk=$.trim(original.substr(0,mid+1))+options.ellipsis,setText(element,chunk),$rootNode.height()>options.maxHeight?high=mid-1:(low=mid+1,maxChunk=maxChunk.length>chunk.length?maxChunk:chunk);return maxChunk.length>0?(setText(element,maxChunk),!0):truncateNearestSibling($element,$rootNode,$clipNode,options)}function truncateNestedNode($element,$rootNode,$clipNode,options){var $child,child,element=$element[0],$children=$element.contents(),index=0,length=$children.length,truncated=!1;for($element.empty();length>index&&!truncated;index++)$child=$children.eq(index),child=$child[0],8!==child.nodeType&&(element.appendChild(child),$clipNode.length&&($.inArray(element.tagName.toLowerCase(),BLOCK_TAGS)>=0?$element.after($clipNode):$element.append($clipNode)),$rootNode.height()>options.maxHeight&&(truncated=3===child.nodeType?truncateTextContent($child,$rootNode,$clipNode,options):truncateNestedNode($child,$rootNode,$clipNode,options)),!truncated&&$clipNode.length&&$clipNode.remove());return truncated}function Truncate(element,options){this.element=element,this.$element=$(element),this._name="truncate",this._defaults={lines:1,ellipsis:"\u2026",showMore:"",showLess:""},this.options=$.extend({},this._defaults,options),this.options.maxHeight===undefined&&(this.options.maxHeight=parseInt(this.options.lines,10)*parseInt(this.options.lineHeight,10)),this.$clipNode=$($.parseHTML(this.options.showMore),this.$element),this.original=this.cached=element.innerHTML,this.isTruncated=!1,this.isCollapsed=!0,this.update()}var BLOCK_TAGS=["table","thead","tbody","tfoot","tr","col","colgroup","object","embed","param","ol","ul","dl","blockquote","select","optgroup","option","textarea","script","style"];Truncate.prototype={update:function(html){var wasExpanded=!this.isCollapsed;html?this.original=this.element.innerHTML=html:this.isCollapsed&&this.element.innerHTML===this.cached&&(this.element.innerHTML=this.original);var $wrap=this.$element.wrapInner("<div/>").children();$wrap.css({border:"none",margin:0,padding:0,width:"auto",height:"auto"}),this.isTruncated=!1,$wrap.height()>this.options.maxHeight?this.isTruncated=truncateNestedNode($wrap,$wrap,this.$clipNode,this.options):this.isCollapsed=!1,$wrap.replaceWith($wrap.contents()),this.cached=this.element.innerHTML,wasExpanded&&(this.element.innerHTML=this.original)},expand:function(){this.isCollapsed&&(this.isCollapsed=!1,this.element.innerHTML=this.isTruncated?this.original+this.options.showLess:this.original)},collapse:function(retruncate){this.isCollapsed||(this.isCollapsed=!0,retruncate=retruncate||!1,retruncate?this.update():this.element.innerHTML=this.cached)}},$.fn.truncate=function(options){var args=$.makeArray(arguments).slice(1);return this.each(function(){var truncate=$.data(this,"jquery-truncate");truncate?"function"==typeof truncate[options]&&truncate[options].apply(truncate,args):$.data(this,"jquery-truncate",new Truncate(this,options))})},module.Truncate=Truncate}(this,jQuery);