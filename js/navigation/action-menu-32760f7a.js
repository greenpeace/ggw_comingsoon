$(function(){function once(fn,context){var result;return function(){return fn&&(result=fn.apply(context||this,arguments),fn=null),result}}function overflowDropdown(){$(".action-menu .tabs, .action-menu .tabs li").removeAttr("style");var menuWrapper=$(".action-menu"),fullMenu=menuWrapper.children(".tabs");fullMenu.removeClass("flexthis").removeAttr("style"),$(".action-menu .tabs-overflow").remove();var overFlowMenu="<ul class='tabs-overflow element-invisible'><li><a class='tab-overflow-trigger' href='#' data-dropdown='#am-dropdown'>more <i class='icon-down-mini'></i></a><div class='dropdown dropdown-tip dropdown-relative dropdown-anchor-right' id='am-dropdown'><ul class='dropdown-menu'></ul></div></li></ul>";$(overFlowMenu).appendTo(".action-menu");var fullHeight=menuWrapper.outerHeight(),triggerWidth=$(".action-menu .tab-overflow-trigger").outerWidth();newfullMenu=fullMenu.css("padding-right",triggerWidth),fullMenu.find(".moved").removeClass("moved"),fullMenu.children("li:visible").filter(function(){var elementOffset=$(this).position().top;return elementOffset+$(this).height()>fullHeight}).addClass("moved").clone(!0).prependTo("#am-dropdown .dropdown-menu").children("a");var totalWidth=0;fullMenu.children("li:visible:not(.moved)").each(function(){totalWidth+=$(this).outerWidth(!0)}),$(".action-menu .tabs-overflow").css("left",totalWidth),0!==$("#am-dropdown .dropdown-menu").children("li").length?$(".tabs-overflow").removeClass("element-invisible"):fullMenu.addClass("flexthis").css({"padding-right":"0"})}var resizeTimer,createActionMenu=once(function(){var action_menu_object="<nav class='action-menu'><ul class='tabs'></ul></nav>";$(action_menu_object).insertBefore("header"),$(blocks).each(function(){var blockId=$(this).attr("id"),blockIcon=$(this).children("i").clone().removeClass(function(index,css){var class1=css.match(/(^|\s)block-\S+/g),class2=css.match(/(^|\s)icon-bg\S+/g),class3="element-hidden";return class1+" "+class2+" "+class3}),blockIconClass=blockIcon.attr("class"),blockLabel=$(this).find(".block-title").attr("data-amtitle"),menuItem="<li><a href='#"+blockId+"' class='tab' data-scroll=''><i class='icon "+blockIconClass+"'></i>"+blockLabel+" </a></li>";$(menuItem).appendTo($("nav.action-menu .tabs"))});var lastScrollTop=0;$("a[data-scroll]").on("click",function(e){e.preventDefault();var target=this.hash,$target=$(target),st=$(this).offset().top;if(st>lastScrollTop)var extraOffset=60;else var extraOffset=110;lastScrollTop=st,$("html, body").stop().animate({scrollTop:$target.offset().top-extraOffset},900,"swing",function(){window.location.hash=target})})}),blocks="";if(0==$(".l-has-sidebar-first").length){var blocksMain=$(".l-main-column > .block").not(".hidden-mobile").not(".white-popup"),blocksBottom=$(".region-content-bottom > .block").not(".hidden-mobile").not(".white-popup"),blocksSidebar=$(".l-sidebar > .block").not(".hidden-mobile").not(".white-popup"),blocksHero=$(".region-highlighted > .block").not(".hidden-mobile").not(".white-popup");blocks=blocksMain.add(blocksBottom).add(blocksSidebar).add(blocksHero)}var no=$(blocks).length;if(no>=2&&(createActionMenu(),$(window).width()<900&&$("body").addClass("with-action-menu")),$(window).resize(function(){$(window).width()<900?(clearTimeout(resizeTimer),resizeTimer=setTimeout(overflowDropdown,350),no>=2&&$("body:not(.with-action-menu)")&&$("body").addClass("with-action-menu")):$("body").removeClass("with-action-menu")}),$(window).width()<900&&overflowDropdown(),$(".action-menu li:first").addClass("current"),0!=$(".block .map").length&&$(window).width()<900){var viewportHeight=$(window).height(),navbarHeight=$(".l-branding-header").outerHeight(),contentHeight=viewportHeight-navbarHeight-50;$(".map").not(".flexslider .map").css("height",contentHeight),map.invalidateSize()}if(window.location.hash){var hash=window.location.hash.substring(1);if(hash.match("^block")){$(".action-menu li").removeClass("current"),$('.action-menu li a[href="#'+hash+'"]').parent().addClass("current");var target=hash,$target=$("#"+target);$("html, body").animate({scrollTop:$target.offset().top-110},900,"swing")}}$(".action-menu .tab").click(function(e){$(".action-menu li").removeClass("current"),$(this).parent().addClass("current"),e.preventDefault(),0!=$("input[type=file]").length&&$("input[type=file]").nicefileinput(),0!=$(".block .map").length&&map.invalidateSize(),$(this).closest(".dropdown").hide(),$(window).trigger("resize")}),$(window).width()<900&&$(".show-block").click(function(e){$(".action-menu li").removeClass("current");var currentTab=$(this).attr("href");$(".action-menu li a").each(function(){var link=$(this).attr("href");link==currentTab&&$(this).parent().addClass("current")}),e.preventDefault()})});