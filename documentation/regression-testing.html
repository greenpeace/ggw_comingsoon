<!DOCTYPE html> <html class=no-js dir=ltr lang=en> <head> <meta charset=utf-8> <meta content=true name=HandheldFriendly> <meta content=width name=MobileOptimized> <link href='//www.w3.org/1999/xhtml/vocab' rel=profile> <link href='//ggw-prototype.goalgorilla.com/images/favicon.ico' rel='shortcut icon' type='image/vnd.microsoft.icon'> <meta content='width=device-width, initial-scale=1' name=viewport> <meta content='IE=edge,chrome=1' http-equiv=X-UA-Compatible> <title>CSS Regression testing â€” GGW Style Guide</title> <script src="../js/lazysizes-91258569.js" async=""></script> <!--[if lte IE 8]><script src="../js/html5shiv.min-cc7152cd.js" async=""></script><![endif]--> <!--[if (gte IE 9)|(gt IEMobile 7)|(!IE)]><!--> <link href="../css/all-8b358046.css" rel=stylesheet /> <!--<![endif]--> <script src="../js/modernizr-9f6502b2.js"></script> <link href="../css/fonticons.woff.css" rel=stylesheet /> </head> <body class='index l-has-sidebar-first style-guide'> <!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="//browsehappy.com/">Upgrade to a different browser</a> or <a href="//www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]--> <div class=layout-base> <div class=design-status> <p class=label> Work in progress </p> </div> <div class=l-branding-header> <div class=container> <a class=logo href='index.html' rel=home title=Home> <span class=element-invisible>Greenpeace Greenwire Nederland</span> </a> <div class=mobile-nav> <a class='nav-btn icon-menu' data-nav=js-nav href='#primary-nav' id=main-menu-show> <span class=element-invisible>Show primary navigation</span> </a> </div> </div> </div> <header class='l-header header'> <div class=container> <div class=off-canvas id=primary-nav> <div class=nav-inner-wrap> <div class=block-search> <h2 class='sg-title pull-right'>Style guide</h2> </div> <nav class=main-menu role=navigation> <ul class=menu> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../">Home</a> </li> <li class='menu-item expanded'> <a class=menu-link page="/documentation/regression-testing.html" href="getting-started.html">Documentation</a> <ul class=menu> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="getting-started.html">Getting started</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="styleguide-structure.html">Style guide structure</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="browser-support.html">Device & browser support</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="progressive-enhancement.html">Progressive enhancement</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="development-principles.html">Development principles</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="editing.html">Editing the style guide</a> </li> <li class=menu-item> <a class="menu-link active" page="/documentation/regression-testing.html" href="regression-testing.html">CSS regression testing</a> </li> </ul> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../design-elements/colors.html">Design elements</a> <ul class=menu> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../design-elements/colors.html">Color Pallete</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../design-elements/typography.html">Typography</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../design-elements/grid.html">Grid</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../design-elements/icons.html">Icons</a> </li> </ul> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/blocks.html">UI components</a> <ul class=menu> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/blocks.html">Blocks</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/tabs.html">Tabs</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/buttons.html">Buttons</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/dropdowns.html">Dropdowns</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/forms.html">Forms</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/images.html">Images</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/breadcrumbs.html">Breadcrumbs</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/hero.html">Hero / Slideshow</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/pagination.html">Pagination</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/progress-bar.html">Progress bar</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/collapse.html">Collapse</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/teasers.html">Teasers</a> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../components/comments.html">Comments</a> </li> </ul> </li> <li class=menu-item> <a class=menu-link page="/documentation/regression-testing.html" href="../prototype/">Prototype</a> </li> </ul> </nav> </div> </div> </div> </header> <div class='l-main container' id=main> <nav class=breadcrumb role=navigation> <h2 class=element-invisible>Pathway</h2> <ol class=breadcrumbs> <li class=breadcrumb-item>You are here:</li> <li class=breadcrumb-item> <a class=breadcrumb-link href='/'> Styleguide </a> </li> <li class=breadcrumb-item> <a class=breadcrumb-link href='./getting-started.html'> Documentation </a> </li> <li class=breadcrumb-item> CSS Regression testing </li> </ol> </nav> <aside class=sidebar-first> <div class='block block-sf-nav affix-top' data-offset-top=110 data-spy=affix> <i class='block-icon icon-info icon-bg-default'></i> <h2 class=block-title>Documentation</h2> <div class=content> <a class=sf-navbtn page="/documentation/regression-testing.html" href="getting-started.html">Getting started</a> <a class=sf-navbtn page="/documentation/regression-testing.html" href="styleguide-structure.html">Style guide structure</a> <a class=sf-navbtn page="/documentation/regression-testing.html" href="browser-support.html">Device & browser support</a> <a class=sf-navbtn page="/documentation/regression-testing.html" href="progressive-enhancement.html">Progressive enhancement</a> <a class=sf-navbtn page="/documentation/regression-testing.html" href="development-principles.html">Development principles</a> <a class=sf-navbtn page="/documentation/regression-testing.html" href="editing.html">Editing the style guide</a> <a class="sf-navbtn active" page="/documentation/regression-testing.html" href="regression-testing.html">CSS regression testing</a> </div> </div> </aside> <div class=l-main-column id=content> <div class='block main-content'> <i class='block-icon icon-bg-default icon-info'></i> <h1 class=block-title>CSS regression testing with BackstopJS</h1> <article class=content> <em>Breaking CSS is easy. Checking every responsive page element is hard.</em> <p>BackstopJS automates CSS regression testing of your responsive web UI by comparing DOM screenshots at various viewport sizes.</p> <h2 class=section-heading>Heres how it works:</h2> <ol> <li>Set up a test config file: specify screen sizes and DOM selectors.</li> <li>Use BackstopJS to create reference screenshots.</li> <li>Make some changes to your CSS or add new DOM components.</li> <li>Run a test. BackstopJS creates a set of test screenshots and any changes show up in a nice report.</li> </ol> </article> </div> <section class=block> <i class='block-icon icon-install icon-bg-default'></i> <h2 class=block-title>Installation</h2> <article class=content> <p><strong>BackstopJS package</strong></p> <p>You can add BackstopJS from the root directory of any project.</p> <pre class="highlight plaintext"><code>$ npm install --save-dev backstopjs&#x000A;</code></pre> <p>This will create the folder structure <code>./node_modules/backstopjs</code>.</p> <p><strong>If you don't already have a global Gulp instance&#8230;</strong> http://gulpjs.com</p> <pre class="highlight plaintext"><code>$ sudo npm install -g gulp&#x000A;&#x000A;//test for a correct install with...&#x000A;$ gulp -v&#x000A;&gt; CLI version 3.8.10&#x000A;&gt; Local version 3.8.10&#x000A;</code></pre> <p><strong>If you don't already have a global PhantomJS install&#8230;</strong> http://phantomjs.org/download.html</p> <pre class="highlight plaintext"><code>$ sudo npm install -g phantomjs&#x000A;&#x000A;//test for a correct install with...&#x000A;$ phantomjs -v&#x000A;&gt; 1.9.8&#x000A;</code></pre> <p><strong>If you don't already have a global CasperJS install&#8230;</strong> http://docs.casperjs.org/en/latest/ installation.html</p> <pre class="highlight plaintext"><code>$ sudo npm install -g casperjs&#x000A;&#x000A;//test for a correct install with...&#x000A;$ casperjs --version&#x000A;&gt; 1.1.0-beta3&#x000A;</code></pre> </article> </section> <section class=block> <i class='block-icon icon-settings icon-bg-default'></i> <h2 class=block-title>Configuration</h2> <article class=content> <p><strong>If you don't already have a BackstopJS config file.</strong> The following command will create a config template file which you can modify in your root directory. <em>Note: this will overwrite any existing backstopjs config file.</em></p> <p>From <code>./node_modules/backstopjs</code> &#8230;</p> <pre class="highlight plaintext"><code>$ gulp genConfig&#x000A;</code></pre> <p>This will generate a boilerplate JSON configuration file for you at the root of your project e.g. <code>greenwire-styleguide/source/backstop.json</code>. This is where you can specify the URL's, selectors to test and at which breakpoints you want to test them at.</p> <pre class="highlight json"><code><span class="w">    </span><span class="p">{</span><span class="w">&#x000A;      </span><span class="s2">"viewports"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">&#x000A;        </span><span class="p">{</span><span class="w">&#x000A;          </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"phone"</span><span class="p">,</span><span class="w">&#x000A;          </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">320</span><span class="p">,</span><span class="w">&#x000A;          </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">480</span><span class="w">&#x000A;        </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">&#x000A;          </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tablet_small"</span><span class="p">,</span><span class="w">&#x000A;          </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">480</span><span class="p">,</span><span class="w">&#x000A;          </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">768</span><span class="w">&#x000A;        </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">&#x000A;          </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"tablet"</span><span class="p">,</span><span class="w">&#x000A;          </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">768</span><span class="p">,</span><span class="w">&#x000A;          </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">1024</span><span class="w">&#x000A;        </span><span class="p">},</span><span class="w"> </span><span class="p">{</span><span class="w">&#x000A;           </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"desktop"</span><span class="p">,</span><span class="w">&#x000A;           </span><span class="s2">"width"</span><span class="p">:</span><span class="w"> </span><span class="mi">1024</span><span class="p">,</span><span class="w">&#x000A;           </span><span class="s2">"height"</span><span class="p">:</span><span class="w"> </span><span class="mi">768</span><span class="w">&#x000A;        </span><span class="p">}</span><span class="w">&#x000A;      </span><span class="p">],</span><span class="w">&#x000A;      </span><span class="s2">"scenarios"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">&#x000A;        </span><span class="p">{</span><span class="w">&#x000A;          </span><span class="s2">"label"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Forms"</span><span class="p">,</span><span class="w">&#x000A;          </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://ggw-prototype.goalgorilla.com/components/forms.html"</span><span class="p">,</span><span class="w">&#x000A;          </span><span class="s2">"selectors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">&#x000A;            </span><span class="s2">"#test-basic-form"</span><span class="p">,</span><span class="w">&#x000A;            </span><span class="s2">"#test-horizontal-form"</span><span class="w">&#x000A;          </span><span class="p">],</span><span class="w">&#x000A;          </span><span class="s2">"readyEvent"</span><span class="p">:</span><span class="w"> </span><span class="s2">"domready"</span><span class="p">,</span><span class="w">&#x000A;          </span><span class="s2">"delay"</span><span class="p">:</span><span class="w"> </span><span class="mi">500</span><span class="w">&#x000A;        </span><span class="p">}</span><span class="w">&#x000A;      </span><span class="p">]</span><span class="w">&#x000A;    </span><span class="p">}</span><span class="w">&#x000A;&#x000A;</span></code></pre> <p>In this configuration you can see three <strong>viewports</strong> objects, one for phone, one for small tablets, one for iPad tablet landscape and one for desktop, each with a name and a viewport property. You can add as many viewports objects as you need. BackstopJS requires at least one.</p> <p>Then we have <strong>scenarios</strong>. This specifies the URLs and element selectors that BackstopJS will test. The selectors generally accept standard CSS selector notation. It's useful to think of every scenario as a test for a specific static page. Here too, you can add as many scenarios as you need. BackstopJS requires at least one.</p> <p>You may notice that in this config, our URL is pointing to http://ggw-prototype.goalgorilla.com/ (the form page of the UI component library) and that is what we would see if we were to run our test now. This is here to illustrate that BackstopJS can point to local or remote URLs so it's easy to imagine repurposing the same tests for local development, QA, staging and production environments.</p> </article> </section> <section class=block> <i class='block-icon icon-pencil icon-bg-default'></i> <h2 class=block-title>Configuration options</h2> <article class=content> <h4>ReadyEvent and delay</h4> <p>Because we have developed Greenwire primarely for speed, we initialy do not render any more resources than we need. Once this has completed, javascript progressively loads more content or enhances the user experience. The problem testing this is knowing when to take the screenshot. BackstopJS solves this problem with two config properties: readyEvent and delay.</p> <p>The <code>readyEvent</code> property enables you to trigger the screen capture by logging a predefined string to the console. For example, the following line will delay screen capture until the page calls <code>console.log("domready")</code>, which we have defined as the last task to execute by javascript.</p> <p>The <code>delay</code> property enables us to pause screen capturing for a specified duration of time. This delay is applied after <code>readyEvent</code>. In the above example the delay is 0.5 seconds.</p> <h4>Hiding and removing selectors</h4> <p>You will have the option to remove or hide element before the taking the snapshot. For example the cookie message will be in the way on most protype page, so we might want to hide this always. For any regression we want to test on blocks with dynamic content we need to eliminate the dynamic part as in will always fail the test.</p> <p>When you want to hide a selector we apply the style <code>visibility:hidden</code>. There may also be elements which need to be completely removed from the DOM during testing. For that we have <code>removeSelectors</code> which sets elements to <code>display: none</code>.</p> <pre class="highlight json"><code><span class="w">  </span><span class="p">{</span><span class="w">&#x000A;    </span><span class="s2">"viewports"</span><span class="p">:</span><span class="w"> </span><span class="p">[],</span><span class="w">&#x000A;    </span><span class="s2">"scenarios"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">&#x000A;      </span><span class="p">{</span><span class="w">&#x000A;        </span><span class="s2">"url"</span><span class="p">:</span><span class="w"> </span><span class="s2">"https://greenwire.greenpeace.org"</span><span class="p">,</span><span class="w">&#x000A;        </span><span class="s2">"hideSelectors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">&#x000A;          </span><span class="s2">"#elementToHide"</span><span class="w">&#x000A;        </span><span class="p">],</span><span class="w">&#x000A;        </span><span class="s2">"removeSelectors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">&#x000A;          </span><span class="s2">"#elementToRemove"</span><span class="w">&#x000A;        </span><span class="p">],</span><span class="w">&#x000A;        </span><span class="s2">"selectors"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">&#x000A;          </span><span class="s2">"header"</span><span class="w">&#x000A;        </span><span class="p">]</span><span class="w">&#x000A;      </span><span class="p">}</span><span class="w">&#x000A;    </span><span class="p">]</span><span class="w">&#x000A;  </span><span class="p">}</span><span class="w">&#x000A;&#x000A;&#x000A;</span></code></pre> </article> </section> <section class=block> <i class='block-icon icon-pencil icon-bg-default'></i> <h2 class=block-title>Usage</h2> <h4>Generating (or updating) reference screenshots</h4> <p>For each iteration consider if you need to create a new reference. This is how the blocks / screens / pages look before you start making changes. This should always be accurate. You only need to create a reference the first time you work on the project or when you pull in changes a team mate has made and you have not yet included in your reference images.</p> <p>To generate a reference run the following command in your terminal from the root of the backstopJS folder. This task will create a (or update an existing) bitmaps_reference directory with screen captures representing all specified selectors at every breakpoint. Take a look inside <code>../backstopjs/bitmaps_reference</code> to see the images that are created.</p> <pre class="highlight shell"><code>  <span class="nv">$ </span>gulp reference&#x000A;&#x000A;</code></pre> <h4>Running a test</h4> <p>When the reference screenshots are made you a good to go and start modifying the project. If you want to be sure you haven't made any mistakes (like included dynamic content), you better run a test before you start working. To run a test, from the backstopJS folder:</p> <pre class="highlight shell"><code>  <span class="nv">$ </span>gulp <span class="nb">test</span>&#x000A;&#x000A;</code></pre> <p>This task will create a new set of images in <code>../backstopjs/bitmaps_test/&lt;timestamp&gt;/</code>.</p> <p>Once the test images are generated, a web browser should open and a report comparing the most recent test bitmaps against the current reference images will run. Significant differences will be detected and shown.</p> <img alt='Example of a report' src='/photos/backstopJS-example-report.jpg'> <p>Fix any differences before you start changing your CSS. You should be able to do this by adjusting the configuration.</p> <p>When all scenarios have passed, you can start working on the code. Once you are done developing run <code>gulp test</code> to see if you have not created any regression.</p> <p>The best workflow is to always run a test before committing your changes. If you have a peer reviewer the reviewer should of course also run the test as well.</p> </section> </div> </div> <footer class='l-footer footer'> <div class=footer-offset></div> <div class=container> <div class=l-branding-footer> <span>&copy;</span> <strong class=logo-footer>GREENPEACE</strong> <span>2015</span> </div> <ul class=footer-menu> <li> <a href='./privacy-policy.html'>Privacy statement</a> </li> <li> <a href='#'>Copyright</a> </li> <li> <a href='./index.html'>Home</a> </li> <li> <a href='../an/about.html'>About us</a> </li> <li> <a href='../an/contact.html'>Contact us</a> </li> <li> <a href='#'>Press centre</a> </li> </ul> </div> </footer> </div> <script src="../js/all-a3097b94.js"></script> <script src="../js/styleguide-6a02c757.js"></script> <!--[if lte IE 8]><link href="../css/old-ie-7d63172a.css" rel=stylesheet /> <script src="../js/oldie-3c6d2ada.js"></script><![endif]--> </body> </html>